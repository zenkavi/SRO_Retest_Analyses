---
title: "Neuroecon Poster Figures"
output:
  html_document: default
  pdf_document: default
---

```{r, message=FALSE, warning=FALSE, include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(GGally)
library(stringr)
library(plotly)
sem <- function(x) {sd(x, na.rm=T) / sqrt(length(x))}
options(scipen = 1, digits = 4, width = 500)
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}
```

Variables that will be used in the figures for the poster

```{r}
poster_vars <- read.csv('../input/poster_var_list.csv', header=F)

names(poster_vars) = "var"
```

# Lit review figure

Read data in

```{r}
fig_data <- read.csv('../input/lit_review_figure.csv')

fig_data_poster = fig_data[fig_data$dv %in% poster_vars$var,]
```

Split dv column, organize by model fit or raw measure

```{r warning=FALSE, message=FALSE}
fig_data_poster = fig_data_poster %>%
  separate(dv, c("task_group", "var"), sep="\\.",remove=FALSE,extra="merge") %>%
  mutate(task_group = factor(task_group, levels = task_group[order(task)]),
         raw1_fit0 = grepl('raw', variable_type),
         type = as.character(type)) %>%
  separate(var, c("var"), sep="\\.",remove=TRUE,extra="drop") %>%
  mutate(task_group = gsub("_", " ", task_group),
         var = gsub("_", " ", var)) %>%
  arrange(task_group, raw1_fit0, var)
```

```{r}
p1_legend = fig_data_poster %>%
  filter(task == 'task') %>%
ggplot(aes(y = var, x = retest_reliability)) + 
  geom_point(aes(size=sample_size, shape=type))+
  facet_grid(task_group~., switch = "y", scales = "free_y", space = "free_y") +
  theme(panel.spacing = unit(0.5, "lines"), 
        strip.placement = "outside",
        strip.text.y = element_text(angle=180),
        panel.background = element_rect(fill = NA),
        panel.grid.major = element_line(colour = "grey80"),
        legend.position = 'bottom', 
        legend.key.size = unit(2, "cm")) + 
  xlab("")+
  ylab("")+
  scale_x_continuous(limits = c(-0.25,1), breaks=c(-0.25, 0, 0.25, 0.5, 0.75, 1))+
  scale_shape_manual(breaks = sort(fig_data$type), values = c(15, 16, 17, 3))

p1 = fig_data_poster %>%
  filter(task == 'task') %>%
ggplot(aes(y = var, x = retest_reliability)) + 
  geom_point(aes(size=sample_size, shape = type), color='#00BFC4')+
  facet_grid(task_group~., switch = "y", scales = "free_y", space = "free_y") +
  theme(panel.spacing = unit(0.75, "lines"), 
        strip.placement = "outside",
        strip.text.y = element_text(angle=180, size=20),
        panel.background = element_rect(fill = NA),
        panel.grid.major = element_line(colour = "grey80"),
        legend.position = 'bottom') + 
  xlab("")+
  ylab("")+
  scale_x_continuous(limits = c(-0.25,1), breaks=c(-0.25, 0, 0.25, 0.5, 0.75, 1))+
  scale_shape_manual(breaks = sort(fig_data$type), values = c(15, 16, 17, 3))+
  geom_vline(xintercept = 0, color = "red", size = 1)

p2 = fig_data_poster %>%
  filter(task == 'survey') %>%
ggplot(aes(y = var, x = retest_reliability)) + 
  geom_point(aes(size=sample_size, shape = type), color = '#F8766D')+
  facet_grid(task_group~., switch = "y", scales = "free_y", space = "free_y") +
  theme(panel.spacing = unit(0.75, "lines"), 
        strip.placement = "outside",
        strip.text.y = element_text(angle=180, size=20),
        panel.background = element_rect(fill = NA),
        panel.grid.major = element_line(colour = "grey80")) + 
  xlab("")+
  ylab("")+
  scale_x_continuous(limits = c(-0.25,1), breaks=c(-0.25, 0, 0.25, 0.5, 0.75, 1))+
  scale_shape_manual(breaks = sort(fig_data$type), values = c(15, 17, 3))+
  geom_vline(xintercept = 0, color = "red", size = 1)

mylegend<-g_legend(p1_legend)

p3 <- arrangeGrob(arrangeGrob(p1 +theme(legend.position="none"),
                         p2 + theme(legend.position="none"),
                         nrow=1),
             mylegend, nrow=2,heights=c(12, 1))

ggsave('Lit_Review_Poster_Plot.jpg', plot = p3, device = "jpeg", path = "../output/figures/", width = 48, height = 23, units = "in")

```

Bootstrapped reliabilities figure mirroring lit review figure
(excludes DDM)

```{r warning=FALSE, message=FALSE}
lit_rev_uniq_dvs = fig_data %>%
  distinct(dv, .keep_all=T) %>%
  select(-retest_reliability, -type, -days, -sample_size, -reference, -measure_description, -task)

boot_df_lit_rev = boot_df %>%
  left_join(lit_rev_uniq_dvs, by = "dv") %>%
  na.omit()

p4 <- boot_df_lit_rev %>%
  filter(task == 'task') %>%
ggplot(aes(y = var, x = icc)) + 
  geom_point(color = '#00BFC4')+
  facet_grid(task_group~., switch = "y", scales = "free_y", space = "free_y") +
  theme(panel.spacing = unit(0.75, "lines"), 
        strip.placement = "outside",
        strip.text.y = element_text(angle=180, size=20),
        panel.background = element_rect(fill = NA),
        panel.grid.major = element_line(colour = "grey80")) + 
  xlab("")+
  ylab("")+
  scale_x_continuous(limits = c(-0.25,1), breaks=c(-0.25, 0, 0.25, 0.5, 0.75, 1))+
  scale_shape_manual(breaks = sort(fig_data$type), values = c(15, 17, 3))+
  geom_vline(xintercept = 0, color = "red", size = 1)

p5 <- boot_df_lit_rev %>%
  filter(task == 'survey') %>%
ggplot(aes(y = var, x = icc)) + 
  geom_point(color = '#F8766D')+
  facet_grid(task_group~., switch = "y", scales = "free_y", space = "free_y") +
  theme(panel.spacing = unit(0.75, "lines"), 
        strip.placement = "outside",
        strip.text.y = element_text(angle=180, size=20),
        panel.background = element_rect(fill = NA),
        panel.grid.major = element_line(colour = "grey80")) + 
  xlab("")+
  ylab("")+
  scale_x_continuous(limits = c(-0.25,1), breaks=c(-0.25, 0, 0.25, 0.5, 0.75, 1))+
  scale_shape_manual(breaks = sort(fig_data$type), values = c(15, 17, 3))+
  geom_vline(xintercept = 0, color = "red", size = 1)
  
p6 <- arrangeGrob(p4, p5,nrow=1)

ggsave('Bootstrap_Poster_Plot.jpg', plot = p6, device = "jpeg", path = "../output/figures/", width = 48, height = 23, units = "in")
```

Histogram of point estimates comparing distributions of survey vs. task measures

```{r}

```

Stats comparing reliabilities of surveys vs tasks

```{r}

```

Table for survey reliabilities by survey name

```{r}

```

Stats checking if item number makes a difference for reliability estimates for surveys

```{r}

```

Table for task reliabilities by task name

```{r}

```

Stats checking if item number makes a difference for reliability estimates for tasks

```{r}

```

Table for task reliabilities by cognitive construct

```{r}

```

Histogram of DDM vs. RT and accuracy measures

```{r}

```

Statistics comparing average reliabilities for DDM vs raw measures

```{r}

```

Note on metric for retest reliabilities
Scatter plots showing relationships between ICC, Pearson and Spearman

```{r}

```